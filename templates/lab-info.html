{% if role == 'admin'%}
{% extends "admin-index.html" %}
{% elif role == 'teacher' %}
{% extends "teacher-index.html" %}
{% endif %}
{%block nav%}
{{super()}}
{%endblock%}
{% block title %}å®éªŒå®¤è¯¦æƒ…{% endblock %}
{%block body%}
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
    <legend>{{lab.name}}
        {% if role == 'admin'%}
        <button class="layui-btn layui-btn-warm layui-btn-radius layui-btn-sm" id="edit">ç¼–è¾‘</button>
        {% endif %}
    </legend>
  </fieldset> 
  <div style="padding: 20px; background-color: #F2F2F2;">
    <div class="layui-row layui-col-space15">
      <i class="layui-icon">&#xe68e;</i> {{lab.id}}
      <i class="layui-icon">&#xe653;</i> <span id="hs"></span>
      <i class="layui-icon">&#xe638;</i> <span id="hc"></span>
    </div>
  </div> 
<div class="layui-collapse">
    <div class="layui-colla-item">
      <h2 class="layui-colla-title"><i class="layui-icon">&#xe653;</i> è½¯ä»¶</h2>
      <div class="layui-colla-content layui-show">
        <table class="layui-hide" id="sTest" lay-filter="sTest"></table>
      </div>
    </div>
    <div class="layui-colla-item">
      <h2 class="layui-colla-title"><i class="layui-icon">&#xe638;</i> ç”µè„‘</h2>
      <div class="layui-colla-content layui-show">
        <table class="layui-hide" id="cTest" lay-filter="cTest"></table>
      </div>
    </div>
</div>
{% endblock %}

{% block script %}
<script type="text/html" id="toolbar">
  <div class="layui-btn-container">
    <!-- <button class="layui-btn layui-btn-sm" lay-event="getCheckData">åˆ é™¤é€‰ä¸­è¡Œæ•°æ®</button> -->
    <button class ="layui-btn layui-btn layui-btn-sm" data-type ="reload" lay-event="reload"><i class="layui-icon" >&#xe669;</i></button>
    <button class ="layui-btn layui-btn-primary layui-btn-sm" data-type ="reload" lay-event="search"><i class="layui-icon">&#xe615;</i></button>
  </div>
</script>
<script>
    layui.use('table', function(){
      var table = layui.table;
      $('#edit').on('click',function(){
        layer.prompt({
          formType: 2,
          value: '',
          title: 'ğŸ˜€æ–°åå­—' 
        }, function(value, index, elem){
          //alert(value); //å¾—åˆ°value
          if(value != "")
          {
            var pdata = {
              labId:'{{labId}}',
              lName:value
          };
          $.ajax({
            type:'post',
            async:true,
            url:"{{url_for('lab_manage.set_lab')}}",
            data:pdata,
            success:function (result) {
              window.location.reload();
                layer.msg('ä¿®æ”¹æˆåŠŸ'
                ,{
                    time:1000
                });

            },
            error: function(){
                layer.msg('ä¿®æ”¹å¤±è´¥'
                ,{
                    time:1000
                })}
            
        });

          }
          layer.close(index);
        });

        });
      

      table.render({
        elem: '#sTest'
        ,skin: 'nob'
        ,size: 'lg'
        ,url:'{{ url_for("soft_manage.check_softwares") }}'
        ,toolbar: '#toolbar' //å¼€å¯å¤´éƒ¨å·¥å…·æ ï¼Œå¹¶ä¸ºå…¶ç»‘å®šå·¦ä¾§æ¨¡æ¿
        ,title: 'è½¯ä»¶æ•°æ®è¡¨'
        ,where:{
          labId:"{{labId}}"
        }
        ,cols: [[
       
          {field:'id', title:'è½¯ä»¶id', width:150, fixed: 'left', unresize: true, sort: true}
          ,{field:'sName', title:'è½¯ä»¶å', width:120}
          ,{field:'version', title:'ç‰ˆæœ¬', width:120}
          ,{field:'sysType', title:'ç³»ç»Ÿè¦æ±‚', width:150}
          ,{field:'aId', title:'å…¥åº“æ“ä½œå‘˜', width:180}
         // ,{fixed: 'right', title:'æ“ä½œ', toolbar: '#bar', width:150}
        ]]
        ,align:"center"
        ,page: true
        ,limit: 7
        ,response: {
            statusCode: 0 //é‡æ–°è§„å®šæˆåŠŸçš„çŠ¶æ€ç ä¸º 200ï¼Œtable ç»„ä»¶é»˜è®¤ä¸º 0
          }
        ,parseData: function(res){ //res å³ä¸ºåŸå§‹è¿”å›çš„æ•°æ®
            $("#hs").text(String(res.count))
            return {
              "code": res.code, //è§£ææ¥å£çŠ¶æ€
              "msg": res.msg, //è§£ææç¤ºæ–‡æœ¬
              "count": res.count, //è§£ææ•°æ®é•¿åº¦
              "data": res.data //è§£ææ•°æ®åˆ—è¡¨
            };
          }

      });

      
      table.render({
        elem:'#cTest',
        where:{
            labId:"{{labId}}"
        },
        url:'{{url_for("computer_manage.check_own_computer")}}',
        toolbar:'#toolbar',
        title:'å·²æœ‰ç”µè„‘è¡¨',

        cols:[[
           // {type: 'checkbox', fixed: 'left'}
            {field:'id', title:'id', width:150, fixed: 'left', unresize: true, sort: true}
            ,{field:'cName', title:'ç”µè„‘å', width:120}
            ,{field:'producer', title:'å‡ºå‚å•†', width:120}
            ,{field:'cpu', title:'cpuçº§åˆ«', width:120}
            ,{field:'cMm', title:'å†…å­˜', width:120}
            ,{field:'normal',title:'çŠ¶æ€',width:120}
            ,{field:'aId',title:'å…¥åº“æ“ä½œå‘˜',width:120}
           // ,{fixed: 'right', title:'æ³¨é”€', toolbar: '#outbar', width:150}                            
        ]]
        ,page: true
        ,limit: 7
        ,response: {
            statusCode: 0 //é‡æ–°è§„å®šæˆåŠŸçš„çŠ¶æ€ç ä¸º 200ï¼Œtable ç»„ä»¶é»˜è®¤ä¸º 0
          }
        ,parseData: function(res){ //res å³ä¸ºåŸå§‹è¿”å›çš„æ•°æ®
            $("#hc").text(String(res.count))
            return {
              "code": res.code, //è§£ææ¥å£çŠ¶æ€
              "msg": res.msg, //è§£ææç¤ºæ–‡æœ¬
              "count": res.count, //è§£ææ•°æ®é•¿åº¦
              "data": res.data //è§£ææ•°æ®åˆ—è¡¨
            };
          }                    
    })
      //å¤´å·¥å…·æ äº‹ä»¶
      table.on('toolbar(cTest)', function(obj){
        var checkStatus = table.checkStatus(obj.config.id);
        switch(obj.event){
          case 'search':
            layer.prompt({
              formType: 2,
              value: '',
              title: 'ğŸ˜€æœ!' 
            }, function(value, index, elem){
              //alert(value); //å¾—åˆ°value
              table.reload('cTest', { //è¡¨æ ¼çš„id
                where: {
                    'main_search':value
                }
            });
              layer.close(index);
            });

          break;
          case 'reload':
            table.reload('cTest');
          break;
                    //åé¢å†åŠ åŠŸèƒ½
        };
      });
      
      //å¤´å·¥å…·æ äº‹ä»¶
      table.on('toolbar(sTest)', function(obj){
        var checkStatus = table.checkStatus(obj.config.id);
        switch(obj.event){
          case 'search':
            layer.prompt({
              formType: 2,
              value: '',
              title: 'ğŸ˜€æœ!' 
            }, function(value, index, elem){
              //alert(value); //å¾—åˆ°value
              table.reload('sTest', { //è¡¨æ ¼çš„id
                where: {

                    'info_search':value
                }
            });
              layer.close(index);
            });

          break;
          case 'reload':
            table.reload('sTest');
          break;
                    //åé¢å†åŠ åŠŸèƒ½
        };
      });
      
    });
    </script>
{% endblock %}