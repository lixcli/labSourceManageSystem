{% if role == 'admin'%}
{% extends "admin-index.html" %}
{% elif role == 'teacher' %}
{% extends "teacher-index.html" %}
{% endif %}
{%block nav%}
{{super()}}
{%endblock%}
{% block title %}è½¯ä»¶è¯¦æƒ…{% endblock %}
{%block body%}

<!-- å¼¹å‡ºå±‚è¡¨å• -->
<form id="form" class="layui-form" method="post" style="display:none">
    <legend>è½¯ä»¶å</legend>
    <input type="text" name="sName" id="sName" class="layui-input", style="width:100%" required="required"/>
    <br>
    <legend>ç‰ˆæœ¬</legend>
    <input type="text" name="sVersion" id="sVersion" class="layui-input", style="width:100%" required="required"/>
    <br>
    <legend>ç³»ç»Ÿè¦æ±‚</legend>
    <input type="text" name="sSysType" id="sSysType" class="layui-input", style="width:100%" required="required"/>
    <div class="layui-input-block">
    <button type="reset" class="layui-btn layui-btn-primary">é‡ç½®</button>  
    <input type="submit"  id="submit" value="æäº¤"  class="layui-btn"> 
    </div>
</form>
<fieldset class="layui-elem-field layui-field-title" style="margin-top: 20px;">
  <legend>{{soft.sName}}&nbsp;  &nbsp;  &nbsp;  &nbsp; 
      {% if role == 'admin'%}
      <button class="layui-btn layui-btn-warm layui-btn-radius layui-btn-sm" id="edit">ç¼–è¾‘</button>  
      {% endif %}
    </legend>
</fieldset> 
<div style="padding: 20px; background-color: #F2F2F2;">
  <div class="layui-row layui-col-space15">
      <i class="layui-icon">&#xe60b;</i> {{soft.version}}
      <i class="layui-icon">&#xe653;</i> {{soft.sysType}}
      <i class="layui-icon">&#xe68e;</i> <span id="lab_count"></span>
  </div>
</div> 

<div class="layui-collapse">
    <div class="layui-colla-item">
      <h2 class="layui-colla-title">å·²æœ‰è¯¥è½¯ä»¶çš„å®éªŒå®¤</h2>
      <div class="layui-colla-content layui-show">
        <table class="layui-show" id="sTest" lay-filter="sTest"></table>
      </div>
    </div>
</div>
{% endblock %}
{% block script %}
<script type="text/html" id="toolbar">
  <div class="layui-btn-container">
    <!-- <button class="layui-btn layui-btn-sm" lay-event="getCheckData">åˆ é™¤é€‰ä¸­è¡Œæ•°æ®</button> -->
    <button class ="layui-btn layui-btn-primary layui-btn-sm" data-type ="reload" lay-event="search"><i class="layui-icon">&#xe615;</i></button>
    <button class ="layui-btn layui-btn layui-btn-sm" data-type ="reload" lay-event="reload"><i class="layui-icon" >&#xe669;</i></button>
  </div>
</script>
<script>
  $(document).ready(function(){

    layui.use('table', function(){
        var table = layui.table;
        table.render({
          elem: '#sTest'
          ,url:'{{ url_for("lab_manage.check_labs") }}'
          ,toolbar: '#toolbar' //å¼€å¯å¤´éƒ¨å·¥å…·æ ï¼Œå¹¶ä¸ºå…¶ç»‘å®šå·¦ä¾§æ¨¡æ¿
          ,title: 'å®éªŒå®¤æ•°æ®è¡¨'
          ,skin: 'nob'
          ,size: 'lg'
          ,where:{
              sId:"{{sId}}"
            }
          ,cols: [[
            {type: 'checkbox', fixed: 'left'}
            ,{field:'id', title:'å®éªŒå®¤å·', width:150, fixed: 'left', unresize: true, sort: true}
            ,{field:'lName', title:'å®éªŒå®¤å', width:120}
            ,{field:'count', title:'å®éªŒå®¤ç”µè„‘æ•°', width:120}
            ,{field:'hcount', title:'å·²æœ‰ç”µè„‘æ•°', width:120}
            ,{field:'aId', title:'å…¥åº“æ“ä½œå‘˜', width:180}
            //,{fixed: 'right', title:'æ“ä½œ', toolbar: '#bar', width:150}
          ]]
          ,page: true
          ,limit: 7
          ,response: {
              statusCode: 0 //é‡æ–°è§„å®šæˆåŠŸçš„çŠ¶æ€ç ä¸º 200ï¼Œtable ç»„ä»¶é»˜è®¤ä¸º 0
            }
          ,parseData: function(res){ //res å³ä¸ºåŸå§‹è¿”å›çš„æ•°æ®
              $('#lab_count').text(String(res.count))
              return {
                "code": res.code, //è§£ææ¥å£çŠ¶æ€
                "msg": res.msg, //è§£ææç¤ºæ–‡æœ¬
                "count": res.count, //è§£ææ•°æ®é•¿åº¦
                "data": res.data //è§£ææ•°æ®åˆ—è¡¨
              };
            }

        });
    // ç›‘å¬ç¼–è¾‘æ¡†
    $('#edit').on('click',function(){
      layer.open({
        type: 1,
        shade: 0,
         //ç‚¹å‡»é®ç½©å…³é—­
        area: ['400px', '300px'],
        content: $("#form")
        });
    }); 

    $('#submit').on('click',function(){
      var sName = $("#sName").val();
      var sVersion = $("#sVersion").val();
      var sSysType = $("#sSysType").val();

      var pdata = {
        sId:'{{sId}}',
        sName:$('#sName').val(),
        sVersion:$("#sVersion").val(),
        sSysType:$("#sSysType").val()
      }


      $.ajax({
        type:'post',
        async:true,
        url: '{{ url_for("soft_manage.soft_set") }}',
        data:pdata,
        success:function (result) {
          window.location.reload();
            layer.msg('ä¿®æ”¹æˆåŠŸ'
            ,{
                time:1000
            });

        },
        error: function(){
            layer.msg('ä¿®æ”¹å¤±è´¥'
            ,{
                time:1000
            })}
        
    });
        });

        //å¤´å·¥å…·æ äº‹ä»¶
        table.on('toolbar(sTest)', function(obj){
          var checkStatus = table.checkStatus(obj.config.id);
          switch(obj.event){
            case 'search':
              layer.prompt({
                formType: 2,
                value: '',
                title: 'ğŸ˜€æœ!' 
              }, function(value, index, elem){
                //alert(value); //å¾—åˆ°value
                table.reload('sTest', { //è¡¨æ ¼çš„id
                  where: {
                      'info_search':value
                  }
              });
                layer.close(index);
              });

            break;
            case 'reload':
              table.reload('sTest');
            break;
                      //åé¢å†åŠ åŠŸèƒ½
          };
        });
        
      });
      

  })
  </script>
{% endblock %}